<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>FrontEnt</title>
    <base href="/" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
      charset="IANAcharset"
    />

    <link rel="icon" type="image/x-icon" href="assets/logo.ico" />
    <!-- Vendors Style-->
    <link rel="stylesheet" type="text/html" href="assets/css/vendors_css.css" />
    <link
      rel="stylesheet"
      type="text/html"
      href="assets/vendor_components/Magnific-Popup-master/dist/magnific-popup.css"
    />

    <!-- Style-->
    <link rel="stylesheet" type="text/html" href="assets/css/style.css" />
    <link rel="stylesheet" type="text/html" href="assets/css/skin_color.css" />

    <!-- Font awesome -->
    <link
      rel="stylesheet"
      type="text/html"
      href="assets/fontawesome/css/all.css"
    />

    <!-- <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" id="bootstrap-css">
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="//code.jquery.com/jquery-1.11.1.min.js"></script> -->

    <!------ calendar---------->
  </head>
  <body class="theme-primary rtl">
    <app-root></app-root>
  </body>

  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    var Tawk_API = Tawk_API || {},
      Tawk_LoadStart = new Date();
    (function () {
      var s1 = document.createElement("script"),
        s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = "https://embed.tawk.to/628760b87b967b1179905c1c/1g3gd3kmm";
      s1.charset = "UTF-8";
      s1.setAttribute("crossorigin", "*");
      s0.parentNode.insertBefore(s1, s0);
    })();
  </script>
  <!--End of Tawk.to Script-->

  <!-- Vendor JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script src="/assets/js/vendors.min.js"></script>

  <!-- Corenav Master JavaScript -->
  <script src="/assets/front-end-rtl/corenav-master/coreNavigation-1.1.3.css"></script>

  <script src="/assets/js/nav.js"></script>

  <script src="./assets/vendor_components/OwlCarousel2/dist/owl.carousel.js"></script>
  <script src="./assets/vendor_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
  <script src="./assets/vendor_components/select2/dist/js/select2.full.js"></script>

  <script>
    //Initialize Select2 Elements
    $(".select2").select2();
  </script>

  <script
    src="https://kit.fontawesome.com/25decb4169.js"
    crossorigin="anonymous"
  ></script>

  <!-- crc front end -->
  <script src="./assets/js/template.js"></script>
  <script>
    am4core.ready(function () {
      // Themes begin
      am4core.useTheme(am4themes_material);
      // Themes end

      // Create map instance
      var chart = am4core.create("chartdiv", am4maps.MapChart);
      chart.maxZoomLevel = 64;

      // Set map definition
      chart.geodata = am4geodata_usaLow;

      // Set projection
      chart.projection = new am4maps.projections.AlbersUsa();

      // Add button
      var zoomOut = chart.tooltipContainer.createChild(am4core.ZoomOutButton);
      zoomOut.align = "right";
      zoomOut.valign = "top";
      zoomOut.margin(20, 20, 20, 20);
      zoomOut.events.on("hit", function () {
        if (currentSeries) {
          currentSeries.hide();
        }
        chart.goHome();
        zoomOut.hide();
        currentSeries = regionalSeries.US.series;
        currentSeries.show();
      });
      zoomOut.hide();

      // Create map polygon series
      var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());
      polygonSeries.useGeodata = true;
      polygonSeries.calculateVisualCenter = true;

      // Configure series
      var polygonTemplate = polygonSeries.mapPolygons.template;
      polygonTemplate.tooltipText = "{name}";
      polygonTemplate.fill = chart.colors.getIndex(0);

      // Load data when map polygons are ready
      chart.events.on("ready", loadStores);

      // Loads store data
      function loadStores() {
        var loader = new am4core.DataSource();
        loader.url =
          "https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-160/TargetStores.json";
        loader.events.on("parseended", function (ev) {
          setupStores(ev.target.data);
        });
        loader.load();
      }

      // Creates a series
      function createSeries(heatfield) {
        var series = chart.series.push(new am4maps.MapImageSeries());
        series.dataFields.value = heatfield;

        var template = series.mapImages.template;
        template.verticalCenter = "middle";
        template.horizontalCenter = "middle";
        template.propertyFields.latitude = "lat";
        template.propertyFields.longitude = "long";
        template.tooltipText = "{name}:\n[bold]{stores} Universities[/]";

        var circle = template.createChild(am4core.Circle);
        circle.radius = 10;
        circle.fillOpacity = 0.7;
        circle.verticalCenter = "middle";
        circle.horizontalCenter = "middle";
        circle.nonScaling = true;

        var label = template.createChild(am4core.Label);
        label.text = "{stores}";
        label.fill = am4core.color("#fff");
        label.verticalCenter = "middle";
        label.horizontalCenter = "middle";
        label.nonScaling = true;

        var heat = series.heatRules.push({
          target: circle,
          property: "radius",
          min: 10,
          max: 30,
        });

        // Set up drill-down
        series.mapImages.template.events.on("hit", function (ev) {
          // Determine what we've clicked on
          var data = ev.target.dataItem.dataContext;

          // No id? Individual store - nothing to drill down to further
          if (!data.target) {
            return;
          }

          // Create actual series if it hasn't been yet created
          if (!regionalSeries[data.target].series) {
            regionalSeries[data.target].series = createSeries("count");
            regionalSeries[data.target].series.data = data.markerData;
          }

          // Hide current series
          if (currentSeries) {
            currentSeries.hide();
          }

          // Control zoom
          if (data.type == "state") {
            var statePolygon = polygonSeries.getPolygonById("US-" + data.state);
            chart.zoomToMapObject(statePolygon);
          } else if (data.type == "city") {
            chart.zoomToGeoPoint(
              {
                latitude: data.lat,
                longitude: data.long,
              },
              64,
              true
            );
          }
          zoomOut.show();

          // Show new targert series
          currentSeries = regionalSeries[data.target].series;
          currentSeries.show();
        });

        return series;
      }

      var regionalSeries = {};
      var currentSeries;

      function setupStores(data) {
        // Init country-level series
        regionalSeries.US = {
          markerData: [],
          series: createSeries("stores"),
        };

        // Set current series
        currentSeries = regionalSeries.US.series;

        // Process data
        am4core.array.each(data.query_results, function (store) {
          // Get store data
          var store = {
            state: store.MAIL_ST_PROV_C,
            long: am4core.type.toNumber(store.LNGTD_I),
            lat: am4core.type.toNumber(store.LATTD_I),
            location: store.co_loc_n,
            city: store.mail_city_n,
            count: am4core.type.toNumber(store.count),
          };

          // Process state-level data
          if (regionalSeries[store.state] == undefined) {
            var statePolygon = polygonSeries.getPolygonById(
              "US-" + store.state
            );
            if (statePolygon) {
              // Add state data
              regionalSeries[store.state] = {
                target: store.state,
                type: "state",
                name: statePolygon.dataItem.dataContext.name,
                count: store.count,
                stores: 1,
                lat: statePolygon.visualLatitude,
                long: statePolygon.visualLongitude,
                state: store.state,
                markerData: [],
              };
              regionalSeries.US.markerData.push(regionalSeries[store.state]);
            } else {
              // State not found
              return;
            }
          } else {
            regionalSeries[store.state].stores++;
            regionalSeries[store.state].count += store.count;
          }

          // Process city-level data
          if (regionalSeries[store.city] == undefined) {
            regionalSeries[store.city] = {
              target: store.city,
              type: "city",
              name: store.city,
              count: store.count,
              stores: 1,
              lat: store.lat,
              long: store.long,
              state: store.state,
              markerData: [],
            };
            regionalSeries[store.state].markerData.push(
              regionalSeries[store.city]
            );
          } else {
            regionalSeries[store.city].stores++;
            regionalSeries[store.city].count += store.count;
          }

          // Process individual store
          regionalSeries[store.city].markerData.push({
            name: store.location,
            count: store.count,
            stores: 1,
            lat: store.lat,
            long: store.long,
            state: store.state,
          });
        });

        regionalSeries.US.series.data = regionalSeries.US.markerData;
      }
    }); // end am4core.ready()
  </script>
</html>
